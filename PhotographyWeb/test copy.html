<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RCC Photography — Guided Quote Journey</title>
  <meta name="description" content="Guided, animated quote + inquiry builder for RCC Photography with live pricing." />
  <meta name="theme-color" content="#c2a47d" />
  <style>
    :root {
      --bg: #faf8f6;
      --card: #ffffff;
      --text: #1a1a1a;
      --muted: #6b6b6b;
      --accent: #c2a47d;
      --accent-dark: #a7865f;
      --border: #e8e1d8;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; color: var(--text); background: linear-gradient(180deg, var(--bg), #fff); }
    header {
      padding: 0.1rem 0.1rem;
      text-align: center; }
    h1 { 
      letter-spacing: .5px;
      margin: 0rem 0rem;
      font-size: clamp(1.5rem, 2.5vw, 2rem); }
      .tag {
        margin: 0.5rem 0rem 0rem;
        color: var(--muted); 
        font-size: .95rem; }

    .hidden { display: none !important; }
    .mt-2 { margin-top: .75rem; }
    .mt-3 { margin-top: .75rem; }

    .container {
      width: 100%;
      margin: auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0rem;
      align-items: start;
      max-width: 1600px;
      padding: 0rem;
      /* Height is not restricted here, so vertical overflow is handled by children */
      justify-content: center;
    }

    .guided-steps {
      max-width: 800px;
      margin: 1rem 1rem;
      flex-direction: column;
      /* Allow vertical growth */
    }

    .estimate-sticky {
      max-width: 800px;
      margin: 1rem 1rem;
      flex-direction: column;
      /* Allow vertical growth */
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,.04);
      padding: 2rem;
      /* No height restriction, cards expand to fit content */
    }

    .stepper { display:flex; align-items:center; gap:.5rem; margin: .25rem 0 1rem; }
    .dot { width: 8px; height: 8px; border-radius:999px; background:#e9e1d6; transition: all .25s ease; }
    .dot.on { background: var(--accent); transform: scale(1.15); }
    .step-label { margin-left:.5rem; color:var(--muted); font-size:.95rem; }

  .slides {
    position: relative;
    min-height: 0;
    overflow: visible;
  }
  .slide {
    display: none;
    padding-top: .25rem;
    /* Remove absolute positioning so slides are contained in card */
  }
  .slide.active {
    display: block;
  }

    label { display:block; font-weight:600; margin:.5rem 0 .35rem; }
    .hint { color: var(--muted); font-size: .9rem; }

    input, select, textarea { width:100%; padding:.7rem .8rem; border-radius:10px; border:1px solid var(--border); background:#fff; font-size:1rem; transition: box-shadow .2s ease, border-color .2s ease; }
    input:focus-visible, select:focus-visible, textarea:focus-visible { outline:none; border-color:var(--accent); box-shadow: 0 0 0 3px rgba(194,164,125,.15); }
    textarea{ min-height:110px; }

    .error-msg {
      color: #e57373;
      font-size: 1rem;
      font-weight: 600;
      margin: 1rem 0 0 0;
      text-align: center;
      display: block;
  }
  .missing-field {
    border: 2px solid #e57373 !important;
    box-shadow: 0 0 0 2px #e5737333;
  }

    .row{ display:grid; grid-template-columns:1fr 1fr; gap:.75rem; }
    .row-3{ display:grid; grid-template-columns: repeat(3,1fr); gap:.75rem; }
    @media (max-width: 640px) { .row, .row-3 { grid-template-columns: 1fr; } }

    .pill { display:inline-flex; align-items:center; gap:.5rem; padding:.45rem .75rem; border:1px solid var(--border); border-radius:999px; cursor:pointer; user-select:none; background:#fff; }
    .pill input{ width:auto; }

    .nav { display:flex; justify-content:space-between; gap:.5rem; margin-top:1rem; }
    .btn { appearance:none; border:0; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.85rem 1rem; border-radius:12px; font-weight:700; font-size:1rem; background:var(--accent); color:#fff; }
    .btn:hover{ background:var(--accent-dark); }
    .btn.secondary{ background:#fff; color:var(--text); border:1px solid var(--border); }
    .btn.ghost{ background:transparent; border:1px dashed var(--border); color:var(--muted); }

    .section-title { margin: .25rem 0 .75rem; font-size: 1.1rem; }
    #journeyTitle.section-title { display: block; width: 100%; text-align: center; font-size: 2.2rem; font-weight: 700; letter-spacing: 0.5px; }

    .price { font-feature-settings:"tnum" on, "lnum" on; font-variant-numeric:tabular-nums; }
    .sum-line { display:flex; justify-content:space-between; margin:.35rem 0; }
    .sum-line.total { font-size:1.15rem; font-weight:800; }
    .hr { height:1px; background:var(--border); margin:.75rem 0; }
    .muted{ color:var(--muted); }
    .badge { display:inline-block; padding:.15rem .5rem; border-radius:8px; background:#f3eee6; color:#7a5f3e; font-size:.8rem; font-weight:700; }

    .flash { animation: flash .4s ease; }
    @keyframes flash { from { background: #fff5e9; } to { background: transparent; } }

    .review-box {
      background: #faf7f2;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem 1rem;
      white-space: pre-wrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
      min-height: 180px;
      height: auto;
      max-height: none;
      overflow-y: auto;
      width: 100%;
      box-sizing: border-box;
    }

    /* Package details (estimate panel) */
    .pkg-details { border: 1px dashed var(--border); border-radius: 12px; padding: .75rem; margin-top: .75rem; }
    .pkg-title { font-weight: 700; margin: 0 0 .25rem; font-size: 1rem; }
    .pkg-desc { margin: 0 0 .35rem; color: var(--muted); font-size: .95rem; }
    .pkg-includes { margin: 0; padding-left: 1.1rem; font-size: .95rem; }
    .pkg-includes li { margin: .15rem 0; }

    @media (prefers-reduced-motion: reduce) { .slide, .dot { transition: none; } }
  </style>
</head>
<body>
  <header>
    <h1>Build Your Photography Package</h1>
    <p class="tag" aria-label="brand tagline">RCC Photography • Guided journey • Live estimate</p>
  </header>

  <main class="container">
    <section class="guided-steps" aria-labelledby="journeyTitle">
      <div class="card">
        <div class="stepper" id="stepper" aria-hidden="true" aria-live="polite"></div>
        <h2 id="journeyTitle" class="section-title">Let's personalize your session</h2>
        <div class="slides" id="slides" role="group" aria-label="Quote builder steps">
          <div class="slide active" data-step="0">
            <p class="muted">Answer a few quick questions. You’ll see your estimate update on the right after each step. No payment collected here.</p>
            <div class="nav">
              <button class="btn" id="startBtn" type="button">Continue</button>
              <button class="btn secondary" id="resetBtn" type="button">Reset Quote</button>
            </div>
          </div>

          <div class="slide" data-step="1">
            <label for="service">What are we celebrating?</label>
            <select id="service" aria-label="Service type">
              <option value="">Select…</option>
              <option value="wedding">Wedding</option>
              <option value="engagement">Engagement</option>
              <option value="family">Family</option>
              <option value="senior">Senior</option>
              <option value="events">Events</option>
            </select>
            <div class="nav">
              <button class="btn secondary" data-nav="prev" type="button">Back</button>
              <button class="btn" data-nav="next" type="button">Next</button>
            </div>
          </div>

          <div class="slide" data-step="2">
            <label for="package">Choose a package</label>
            <select id="package" aria-label="Package"></select>
            <div class="row mt-2">
              <div>
                <label for="hours">Hours of coverage</label>
                <!-- Read-only / fixed to package hours -->
                <input type="number" id="hours" min="1" step="1" inputmode="numeric" readonly disabled aria-readonly="true" />
                <div class="hint">Package hours are fixed. Add extra time on the next step.</div>
              </div>
              <div id="headcountWrap">
                <label for="headcount">Approx. headcount (optional)</label>
                <input type="number" id="headcount" min="1" step="1" inputmode="numeric" />
              </div>
            </div>
            <div class="nav">
              <button class="btn secondary" data-nav="prev" type="button">Back</button>
              <button class="btn" data-nav="next" type="button">Next</button>
            </div>
          </div>

          <div class="slide" data-step="3">
            <p class="section-title" style="margin-top:.25rem;">Would you like any add‑ons?</p>
            <div class="row-3" id="addonsWrap"></div>
            <div class="row mt-2">
              <div>
                <label for="extraHours">Extra hours</label>
                <input type="number" id="extraHours" min="0" step="1" value="0" inputmode="numeric" />
              </div>
            </div>
            <div class="nav">
              <button class="btn secondary" data-nav="prev" type="button">Back</button>
              <button class="btn" data-nav="next" type="button">Next</button>
            </div>
          </div>

          <div class="slide" data-step="4">
            <p class="section-title">Where will we be?</p>
            <div class="row">
              <div>
                <label for="location">Location / Venue</label>
                <input id="location" name="location" placeholder="City, venue, or area" />
              </div>
              <div>
                <label for="date">Preferred date</label>
                <input id="date" name="date" type="date" />
              </div>
            </div>
            <div class="nav">
              <button class="btn secondary" data-nav="prev" type="button">Back</button>
              <button class="btn" data-nav="next" type="button">Next</button>
            </div>
          </div>

          <div class="slide" data-step="5">
            <p class="section-title">How can I reach you?</p>
            <div class="row">
              <div>
                <label for="name">Full name</label>
                <input id="name" name="name" autocomplete="name" required />
              </div>
              <div>
                <label for="email">Email</label>
                <input id="email" name="email" type="email" autocomplete="email" required />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="phone">Phone</label>
                <input id="phone" name="phone" type="tel" autocomplete="tel" />
              </div>
            </div>
            <div class="row">
              <div style="grid-column: 1 / -1;">
                <label for="notes">Notes (timeline, vision, must‑haves)</label>
                  <textarea id="notes" placeholder="Share details you'd like me to know" style="resize: vertical;"></textarea>
              </div>
            </div>
            <div class="nav">
              <button class="btn secondary" data-nav="prev" type="button">Back</button>
              <button class="btn" data-nav="next" type="button">Review</button>
            </div>
          </div>

          <div class="slide" data-step="6">
            <h3 class="section-title">Review & send</h3>
            <p class="muted">Here’s a summary of your selections. You can go back to make changes.</p>
            <pre id="reviewBox" class="review-box" aria-live="polite"></pre>
            <div class="nav">
              <button class="btn secondary" data-nav="prev" type="button">Back</button>
              <button class="btn" id="btnCompose" type="button">Send Inquiry Email</button>
            </div>
          </div>
        </div>
        <div id="errorMsgContainer"></div>
      </div>
    </section>

    <aside class="estimate-sticky" aria-label="Live estimate">
      <div class="card">
        <h2 class="section-title">Estimate</h2>
        <div id="estimateBox">
          <div class="sum-line"><span>Base package</span><span class="price" id="sumBase">$0</span></div>
          <div class="sum-line"><span>Hours adjustment</span><span class="price" id="sumHours">$0</span></div>
          <div class="sum-line"><span>Add‑ons</span><span class="price" id="sumAddons">$0</span></div>

          <div id="addonItems" class="mt-2" aria-live="polite"></div>
          
          <div class="hr" role="separator" aria-hidden="true"></div>
          <div class="sum-line total"><span>Estimated total</span><span class="price" id="sumTotal">$0</span></div>

          <!-- Package details injected here -->
          <div id="pkgDetails" class="pkg-details hidden" aria-live="polite"></div>

          <p class="muted mt-2">Travel cost are not included in this estimate. Driving mileage starts after 100 miles from RCC Photography's Sioux Falls Office.</p>
          <p id="retainerNote" class="muted hidden mt-2">
            <span class="badge">Wedding</span></p>
          <p class="muted mt-3">Taxes (if applicable) not included. This is intended to be used for price estimates only. Final proposals will be sent via email through Honeybook.</p>
          <div class="hr" role="separator" aria-hidden="true"></div>
          <button class="btn ghost" id="btnCopy" type="button" style="width:100%">Copy Summary</button>
        </div>
      </div>
    </aside>
  </main>

  <script>
    const CONFIG = {
      EMAIL_TO: "",
      MILEAGE_RATE: 0.67,
      HOURLY_RATE_OVERRIDES: { wedding: 250, engagement: 200, family: 175, senior: 175, events: 225 },
      ADDONS: {
        secondShooter: { label: "Second shooter", price: 400 },
        thirdShooter: { label: "Third shooter", price: 350 },
        rush: { label: "Rush editing", price: 300 },
        extraHour: { label: "Extra hours", price: 200 },
        album: { label: "Album", price: 350 }
      },
      SERVICE_ADDONS: {
        wedding: ["secondShooter", "thirdShooter", "rush", "extraHour", "album"],
        engagement: ["rush", "extraHour", "album"],
        family: ["rush", "extraHour", "album"],
        senior: ["rush", "extraHour", "album"],
        events: ["secondShooter", "thirdShooter", "rush", "extraHour"]
      },
      PACKAGES: {
        wedding: [
          { id:"wed1", name:"Wedding — Classic", hours:6, price:3600, desc:"Coverage for key moments and a full gallery.", includes:["Lead photographer","Timeline consult","Online gallery"] },
          { id:"wed2", name:"Wedding — Signature", hours:8, price:4400, desc:"Most popular: extra coverage for prep and reception.", includes:["Lead photographer","Second shooter (optional add-on)","Sneak peeks within 72h","Online gallery"] },
          { id:"wed3", name:"Wedding — Heirloom", hours:10, price:5500, desc:"All-day story with room for portraits & party.", includes:["Lead photographer","Extended coverage","Keepsake album credit","Online gallery"] }
        ],
        engagement: [
          { id:"eng1", name:"Engagement — Standard", hours:1.5, price: 450, desc:"One location, relaxed prompts.", includes:["Up to 1.5 hrs","Online gallery","Style guidance"] },
          { id:"eng2", name:"Engagement — Extended", hours:2, price: 650, desc:"More time, outfit change, second location.", includes:["Up to 2 hrs","Two locations","Online gallery"] }
        ],
        family: [
          { id:"fam1", name:"Family — Petite", hours:0.75, price:300, desc:"Short & sweet for quick updates.", includes:["45 minutes","One location","Online gallery"] },
          { id:"fam2", name:"Family — Standard", hours:1, price:450, desc:"Room for candid + posed combos.", includes:["60 minutes","Online gallery","Print shop access"] }
        ],
        senior: [
          { id:"sen1", name:"Senior — Standard", hours:1, price:400, desc:"Classic portraits and a few candid looks.", includes:["60 minutes","1–2 outfits","Online gallery"] },
          { id:"sen2", name:"Senior — Deluxe", hours:2, price:650, desc:"Multiple looks and locations.", includes:["120 minutes","2–3 outfits","Two locations","Online gallery"] }
        ],
        events: [
          { id:"evt1", name:"Event — Half Day", hours:4, price:1200, desc:"Great for short events.", includes:["Up to 4 hours","Online gallery"] },
          { id:"evt2", name:"Event — Full Day", hours:8, price:2200, desc:"For conferences and full-day coverage.", includes:["Up to 8 hours","Online gallery"] }
        ]
      }
    };

    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const fmt = n => (Number(n) || 0).toLocaleString(undefined, { style: 'currency', currency: 'USD' });
    const num = v => isNaN(+v) ? 0 : +v;

    const els = {
      slides: $('#slides'), stepper: $('#stepper'),
      service: $('#service'), pkg: $('#package'), hours: $('#hours'), headcount: $('#headcount'), headcountWrap: $('#headcountWrap'),
      secondShooter: $('#secondShooter'), thirdShooter: $('#thirdShooter'), rush: $('#rush'),
      extraHours: $('#extraHours'), albums: $('#albums'), prints: $('#prints'),
      location: $('#location'), date: $('#date'),
      name: $('#name'), email: $('#email'), phone: $('#phone'), notes: $('#notes'),
      sumBase: $('#sumBase'), sumHours: $('#sumHours'), sumAddons: $('#sumAddons'), sumTotal: $('#sumTotal'),
      retainerNote: $('#retainerNote'), reviewBox: $('#reviewBox'),
      btnCopy: $('#btnCopy'), btnCompose: $('#btnCompose'), startBtn: $('#startBtn'),
      addonItems: $('#addonItems'), pkgDetails: $('#pkgDetails'),
      addonsWrap: document.getElementById('addonsWrap')
    };

    // Cache keys
    const CACHE_KEY = 'rccPhotoQuoteProgress';

    // Save progress to localStorage
    function saveProgress() {
      const data = {
        service: els.service.value,
        pkg: els.pkg.value,
        hours: els.hours.value,
        headcount: els.headcount.value,
        extraHours: els.extraHours.value,
        location: els.location.value,
        date: els.date.value,
        name: els.name.value,
        email: els.email.value,
        phone: els.phone.value,
        notes: els.notes.value,
        addons: {}
      };
      // Save add-on checkboxes
      Object.keys(CONFIG.ADDONS).forEach(key => {
        const input = document.getElementById(key);
        if (input && input.type === 'checkbox') {
          data.addons[key] = input.checked;
        }
      });
      localStorage.setItem(CACHE_KEY, JSON.stringify(data));
    }

    // Reset all selections and start from scratch
    function resetQuote() {
      localStorage.removeItem(CACHE_KEY);
      // Clear all form fields
      els.service.value = '';
      loadPackages();
      renderAddons();
      els.pkg.value = '';
      els.hours.value = '';
      els.headcount.value = '';
      els.extraHours.value = '';
      els.location.value = '';
      els.date.value = '';
      els.name.value = '';
      els.email.value = '';
      els.phone.value = '';
      els.notes.value = '';
      // Uncheck all add-ons
      Object.keys(CONFIG.ADDONS).forEach(key => {
        const input = document.getElementById(key);
        if (input && input.type === 'checkbox') {
          input.checked = false;
        }
      });
      go(0);
      compute();
      updateNavButtons();
    }

    // Restore progress from localStorage
    function restoreProgress() {
      const raw = localStorage.getItem(CACHE_KEY);
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        if (data.service) els.service.value = data.service;
        loadPackages();
        renderAddons();
        if (data.pkg) els.pkg.value = data.pkg;
        if (data.hours) els.hours.value = data.hours;
        if (data.headcount) els.headcount.value = data.headcount;
        if (data.extraHours) els.extraHours.value = data.extraHours;
        if (data.location) els.location.value = data.location;
        if (data.date) els.date.value = data.date;
        if (data.name) els.name.value = data.name;
        if (data.email) els.email.value = data.email;
        if (data.phone) els.phone.value = data.phone;
        if (data.notes) els.notes.value = data.notes;
        // Restore add-on checkboxes
        if (data.addons) {
          Object.keys(data.addons).forEach(key => {
            const input = document.getElementById(key);
            if (input && input.type === 'checkbox') {
              input.checked = data.addons[key];
            }
          });
        }
        compute();
        updateNavButtons();
      } catch(e) { /* ignore */ }
    }
    const SHOW_HEADCOUNT_FOR = new Set(['events','wedding','family']);

    let current = 0;
    const lastStep = 6;

    function renderStepper() {
      els.stepper.innerHTML = '';
      for (let i = 0; i <= lastStep; i++) {
        const d = document.createElement('div');
        d.className = 'dot' + (i <= current ? ' on' : '');
        els.stepper.appendChild(d);
      }
      const lbl = document.createElement('span');
      lbl.className = 'step-label';
      lbl.textContent = `Step ${Math.min(current, lastStep)}/${lastStep}`;
      els.stepper.appendChild(lbl);
    }

    function go(step) {
      clearErrorMsg();
      current = Math.max(0, Math.min(step, lastStep));
      $$('.slide').forEach(s => s.classList.remove('active'));
      const next = document.querySelector(`.slide[data-step="${current}"]`);
      if (next) next.classList.add('active');
      renderStepper();
      if (current === 6) {
        els.reviewBox.textContent = summaryText();
      }
    }
    // Generate summary of selections for review box
    function summaryText() {
      const svc = els.service.value;
      const pkgId = els.pkg.value;
      const pkgList = CONFIG.PACKAGES[svc] || [];
      const pkg = pkgList.find(p => p.id === pkgId);
      const base = pkg ? num(pkg.price) : 0;
      const baseHours = pkg ? num(pkg.hours) : 0;
      const extraHours = Math.max(0, num(els.extraHours.value));
      const hourly = CONFIG.HOURLY_RATE_OVERRIDES[svc] ?? 200;
      const hoursAdj = extraHours * hourly;
      let addons = 0;
      let addonItems = [];
      const allowedAddons = CONFIG.SERVICE_ADDONS[svc] || [];
      const shooterHours = baseHours + extraHours;
      allowedAddons.forEach(key => {
        const addon = CONFIG.ADDONS[key];
        const input = document.getElementById(key);
        if (!addon || !input) return;
        if (key === "secondShooter" && input.checked) {
          const secondShooterCost = Math.max(100, shooterHours * 100);
          addons += secondShooterCost;
          addonItems.push(`${addon.label} (${shooterHours} hr${shooterHours !== 1 ? 's' : ''}): ${fmt(secondShooterCost)}`);
        } else if (key === "thirdShooter" && input.checked) {
          const thirdShooterCost = Math.max(100, shooterHours * 100);
          addons += thirdShooterCost;
          addonItems.push(`${addon.label} (${shooterHours} hr${shooterHours !== 1 ? 's' : ''}): ${fmt(thirdShooterCost)}`);
        } else if (key === "rush" && input.checked) {
          const rushCost = Math.max(75, Math.round(base * 0.10));
          addons += rushCost;
          addonItems.push(`${addon.label}: ${fmt(rushCost)}`);
        } else if (key === "album" && input.checked) {
          addons += addon.price;
          addonItems.push(`${addon.label}: ${fmt(addon.price)}`);
        }
      });
      if (allowedAddons.includes("extraHour") && extraHours > 0) {
        addons += extraHours * CONFIG.ADDONS.extraHour.price;
        addonItems.push(`Extra hours (${extraHours}): ${fmt(extraHours * CONFIG.ADDONS.extraHour.price)}`);
      }
      // Compose summary text
      let lines = [];
      lines.push(`Service: ${svc ? svc.charAt(0).toUpperCase() + svc.slice(1) : ''}`);
      if (pkg) {
        lines.push(`Package: ${pkg.name} (${fmt(pkg.price)})`);
        lines.push(`Hours: ${pkg.hours}${extraHours > 0 ? ` + ${extraHours} extra` : ''}`);
      }
      if (SHOW_HEADCOUNT_FOR.has(svc) && els.headcount.value) {
        lines.push(`Headcount: ${els.headcount.value}`);
      }
      if (addonItems.length > 0) {
        lines.push('Add-ons:');
        addonItems.forEach(item => lines.push(`  - ${item}`));
      }
      lines.push(`Location: ${els.location.value}`);
      lines.push(`Date: ${els.date.value}`);
      lines.push(`Name: ${els.name.value}`);
      lines.push(`Email: ${els.email.value}`);
      if (els.phone.value) lines.push(`Phone: ${els.phone.value}`);
      if (els.notes.value) lines.push(`Notes: ${els.notes.value}`);
      lines.push('---');
      lines.push(`Base package: ${fmt(base)}`);
      lines.push(`Hours adjustment: ${fmt(hoursAdj)}`);
      lines.push(`Add-ons: ${fmt(addons)}`);
      lines.push(`Estimated total: ${fmt(base + hoursAdj + addons)}`);
      return lines.join('\n');
    }

    function toggleHeadcount() {
      const svc = els.service.value;
      if (!els.headcountWrap) return;
      els.headcountWrap.classList.toggle('hidden', !SHOW_HEADCOUNT_FOR.has(svc));
      if (!SHOW_HEADCOUNT_FOR.has(svc)) els.headcount.value = '';
    }

    function loadPackages() {
      const svc = els.service.value;
      toggleHeadcount();
      const list = CONFIG.PACKAGES[svc] || [];
      els.pkg.innerHTML = '';
      els.pkg.disabled = false;
      const blankOpt = document.createElement('option');
      blankOpt.value = '';
      blankOpt.textContent = 'Select one';
      blankOpt.disabled = false;
      blankOpt.selected = true;
      els.pkg.appendChild(blankOpt);
      list.forEach(p => {
        const o = document.createElement('option');
        o.value = p.id;
        o.textContent = `${p.name} — ${p.hours} hr${p.hours !== 1 ? 's' : ''}`;
        o.dataset.hours = p.hours; o.dataset.price = p.price;
        els.pkg.appendChild(o);
      });
      els.pkg.value = '';
      els.hours.value = '';
      renderPackageDetails(null);
    }

    function renderPackageDetails(pkg) {
      if (!els.pkgDetails) return;
      if (!pkg) { els.pkgDetails.classList.add('hidden'); els.pkgDetails.innerHTML = ''; return; }
      els.pkgDetails.classList.remove('hidden');
      const items = (pkg.includes || []).map(i => `<li>${i}</li>`).join('');
      els.pkgDetails.innerHTML = `
        <h3 class="pkg-title">${pkg.name}</h3>
        <p class="pkg-desc">${pkg.desc || ''}</p>
        ${items ? `<ul class="pkg-includes">${items}</ul>` : ''}
      `;
    }

    function renderAddons() {
      const svc = els.service.value;
      const allowed = CONFIG.SERVICE_ADDONS[svc] || [];
      if (!els.addonsWrap) return;
      els.addonsWrap.innerHTML = '';
      allowed.forEach(key => {
        if (key === "extraHour") return; // handled separately
        const addon = CONFIG.ADDONS[key];
        if (!addon) return;
        const label = document.createElement('label');
        label.className = 'pill';
        label.innerHTML = `<input type="checkbox" id="${key}"> <span>${addon.label}</span>`;
        els.addonsWrap.appendChild(label);
      });
      // Album add-on for services that allow it
      if (allowed.includes("album") && !document.getElementById("album")) {
        const addon = CONFIG.ADDONS["album"];
        const label = document.createElement('label');
        label.className = 'pill';
        label.innerHTML = `<input type="checkbox" id="album"> <span>${addon.label}</span>`;
        els.addonsWrap.appendChild(label);
      }
    }

    function compute() {
      const svc = els.service.value;
      const list = CONFIG.PACKAGES[svc] || [];
      let pkg = null;
      if (els.pkg.selectedIndex > 0) {
        pkg = list[els.pkg.selectedIndex - 1];
      }
      if (pkg) {
        renderPackageDetails(pkg);
        els.hours.value = pkg.hours;
      } else {
        renderPackageDetails(null);
        els.hours.value = '';
      }

      // Pricing calculations
      const base = pkg ? num(pkg.price) : 0;
      const baseHours = pkg ? num(pkg.hours) : 0;
      const extraHours = Math.max(0, num(els.extraHours.value));
      const hourly = CONFIG.HOURLY_RATE_OVERRIDES[svc] ?? 200;
      const hoursAdj = extraHours * hourly;

      // Add-ons
      let addons = 0;
      let addonItems = [];
      let otherShooterCostPerHr = 100;
      let otherShooterCostMin = 100;
      const allowedAddons = CONFIG.SERVICE_ADDONS[svc] || [];
      // For shooters, use baseHours for calculation
      const shooterHours = baseHours + extraHours;
      allowedAddons.forEach(key => {
        const addon = CONFIG.ADDONS[key];
        const input = document.getElementById(key);
        if (!addon || !input) return;
        if (key === "secondShooter" && input.checked) {
          const secondShooterCost = Math.max(otherShooterCostMin, shooterHours * otherShooterCostPerHr);
          addons += secondShooterCost;
          addonItems.push({ name: `${addon.label} (${shooterHours} hr${shooterHours !== 1 ? 's' : ''})`, price: secondShooterCost });
        } else if (key === "thirdShooter" && input.checked) {
          const thirdShooterCost = Math.max(otherShooterCostMin, shooterHours * otherShooterCostPerHr);
          addons += thirdShooterCost;
          addonItems.push({ name: `${addon.label} (${shooterHours} hr${shooterHours !== 1 ? 's' : ''})`, price: thirdShooterCost });
        } else if (key === "rush" && input.checked) {
          const rushCost = Math.max(75, Math.round(base * 0.10));
          addons += rushCost;
          addonItems.push({ name: addon.label, price: rushCost });
        } else if (key === "album" && input.checked) {
          addons += addon.price;
          addonItems.push({ name: addon.label, price: addon.price });
        }
      });
      // Extra hours is always a number input, not a checkbox
      if (allowedAddons.includes("extraHour") && extraHours > 0) {
        addons += extraHours * CONFIG.ADDONS.extraHour.price;
        addonItems.push({ name: `Extra hours (${extraHours})`, price: extraHours * CONFIG.ADDONS.extraHour.price });
      }

      // Update DOM
  els.sumBase.textContent = fmt(base);
  els.sumHours.textContent = fmt(hoursAdj);
  els.sumAddons.textContent = fmt(addons);
  // Defensive: ensure all values are numbers
  const total = num(base) + num(hoursAdj) + num(addons);
  els.sumTotal.textContent = fmt(total);

      // Add-on items list
      if (els.addonItems) {
        if (addonItems.length > 0) {
          els.addonItems.innerHTML = addonItems.map(item => `<div class="sum-line"><span>${item.name}</span><span class="price">${fmt(item.price)}</span></div>`).join('');
        } else {
          els.addonItems.innerHTML = '';
        }
      }
    }

    // Validation logic for each step
    function validateStep(step) {
      switch (step) {
        case 1:
          return els.service.value !== '';
        case 2:
          // Only require package selection, not hours or index
          return els.pkg.value !== '';
        case 4:
          return els.location.value.trim() !== '' && els.date.value !== '';
        case 5:
          return els.name.value.trim() !== '' && els.email.value.trim() !== '';
        default:
          return true;
      }
    }

    function updateNavButtons() {
      document.querySelectorAll('.slide').forEach((slide, idx) => {
        const nextBtn = slide.querySelector('[data-nav="next"]');
        if (nextBtn) {
          nextBtn.disabled = false; // Always enabled
        }
      });
    }

    document.addEventListener('input', () => {
      compute();
      updateNavButtons();
      saveProgress();
    }, true);

    document.addEventListener('change', (e) => {
      if (e.target === els.service) {
        loadPackages();
        renderAddons();
        go(2);
      }
      compute();
      updateNavButtons();
      saveProgress();
    }, true);

    // Helper to show/hide error message below slides
    function showErrorMsg(step) {
      const container = document.getElementById('errorMsgContainer');
      if (!container) return;
      container.innerHTML = '<span class="error-msg">Missing required fields</span>';

      // Highlight missing fields for current step
      // Remove previous highlights
      document.querySelectorAll('.missing-field').forEach(el => {
        el.classList.remove('missing-field');
      });
      switch (step) {
        case 1:
          if (!els.service.value) els.service.classList.add('missing-field');
          break;
        case 2:
          if (!els.pkg.value) els.pkg.classList.add('missing-field');
          break;
        case 4:
          if (!els.location.value.trim()) els.location.classList.add('missing-field');
          if (!els.date.value) els.date.classList.add('missing-field');
          break;
        case 5:
          if (!els.name.value.trim()) els.name.classList.add('missing-field');
          if (!els.email.value.trim()) els.email.classList.add('missing-field');
          break;
      }
    }
    function clearErrorMsg() {
      const container = document.getElementById('errorMsgContainer');
      if (container) container.innerHTML = '';
      // Remove missing field highlights
      document.querySelectorAll('.missing-field').forEach(el => {
        el.classList.remove('missing-field');
      });
    }

    document.addEventListener('click', (e) => {
      const nav = e.target.closest('[data-nav]');
      if (nav && nav.getAttribute('data-nav') === 'next') {
        if (!validateStep(current)) {
          showErrorMsg(current);
          return;
        } else {
          go(current + 1);
          updateNavButtons();
          return;
        }
      }
      if (nav) {
        const dir = nav.getAttribute('data-nav');
        go(dir === 'next' ? current + 1 : current - 1);
        updateNavButtons();
      }
    });
  els.startBtn?.addEventListener('click', () => { go(1); updateNavButtons(); });

  document.getElementById('resetBtn')?.addEventListener('click', resetQuote);

    // Initial state
    restoreProgress();
    updateNavButtons();

    ['change','input'].forEach(evt => {
      document.addEventListener(evt, e => {
        if (e.target === els.service) {
          loadPackages();
          renderAddons();
          go(2);
        }
        if (e.target === els.pkg) {
          const svc = els.service.value; const list = CONFIG.PACKAGES[svc] || [];
          const selected = list.find(p => p.id === els.pkg.value);
          if (selected) { els.hours.value = selected.hours; renderPackageDetails(selected); }
        }
        compute();
        saveProgress();
      }, true);
    });

    els.btnCopy.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(summaryText()); els.btnCopy.textContent = 'Copied!'; setTimeout(() => els.btnCopy.textContent = 'Copy Summary', 1500); }
      catch(e) { alert('Summary ready to copy:\n' + summaryText()); }
    });

    document.addEventListener('click', (e) => {
      if (e.target.id === 'btnCompose') {
        if (!els.email.value) { alert('Please enter an email address.'); return; }
        const to = CONFIG.EMAIL_TO || '';
        const subject = encodeURIComponent('New Photography Inquiry');
        const body = encodeURIComponent(summaryText());
        window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
      }
    });

    renderStepper();
    compute();
  </script>
</body>
</html>